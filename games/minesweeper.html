<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Minesweeper - Mě to nebaví CZ</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="../assets/theme.css" />
  <script src="../assets/theme.js" defer></script>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet" />
  <style>
    body {
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      padding: clamp(16px, 3vw, 32px);
      gap: 1rem;
    }
    header {
      text-align: center;
    }
    #gameBoard {
      width: min(92vw, 420px);
      display: grid;
      grid-template-columns: repeat(10, minmax(0, 1fr));
      gap: 4px;
      padding: 8px;
      background: var(--surface-2);
      border: 1px solid var(--surface-border);
      border-radius: 16px;
      box-shadow: var(--shadow-soft);
      user-select: none;
    }
    .cell {
      aspect-ratio: 1 / 1;
      background: rgba(148, 163, 184, 0.55);
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 0.95rem;
      cursor: pointer;
      color: #0f172a;
      box-shadow: inset 0 0 6px rgba(15, 23, 42, 0.25);
    }
    .cell.revealed {
      background: #e2e8f0;
      box-shadow: inset 0 0 4px rgba(148, 163, 184, 0.6);
      cursor: default;
    }
    .cell.mine {
      background-color: #ef4444;
      color: #ffffff;
    }
    .cell.flagged {
      background-color: #fbbf24;
      color: #92400e;
    }
  </style>
</head>
<body class="game-page">
  <header>
    <h1 class="hero-title">Minesweeper</h1>
    <p class="hero-subtitle">Najděte všechny miny bez výbuchu.</p>
  </header>

  <div class="panel game-shell" role="main" aria-label="Minesweeper">
    <div class="controls">
      <button id="btnRestart" class="btn btn-secondary">Restart</button>
    </div>
    <div id="gameBoard" role="grid" aria-label="Minesweeper hra"></div>
    <p class="hint">Pravým tlačítkem označíte vlajku.</p>
  </div>

  <a href="../games.html" class="link-back">Zpět na výběr her</a>

  <script>
    const boardSize = 10;
    const mineCount = 15;
    const gameBoard = document.getElementById('gameBoard');
    let board = [];
    let revealedCount = 0;
    let gameOver = false;

    function createBoard() {
      board = [];
      for (let i = 0; i < boardSize * boardSize; i++) {
        board.push({
          mine: false,
          revealed: false,
          flagged: false,
          adjacentMines: 0,
        });
      }
    }

    function placeMines() {
      let minesPlaced = 0;
      while (minesPlaced < mineCount) {
        const index = Math.floor(Math.random() * board.length);
        if (!board[index].mine) {
          board[index].mine = true;
          minesPlaced++;
        }
      }
    }

    function calculateAdjacentMines() {
      for (let i = 0; i < board.length; i++) {
        if (board[i].mine) continue;
        let count = 0;
        const neighbors = getNeighbors(i);
        for (const n of neighbors) {
          if (board[n].mine) count++;
        }
        board[i].adjacentMines = count;
      }
    }

    function getNeighbors(index) {
      const neighbors = [];
      const row = Math.floor(index / boardSize);
      const col = index % boardSize;

      for (let r = row - 1; r <= row + 1; r++) {
        for (let c = col - 1; c <= col + 1; c++) {
          if (r >= 0 && r < boardSize && c >= 0 && c < boardSize) {
            if (r !== row || c !== col) {
              neighbors.push(r * boardSize + c);
            }
          }
        }
      }
      return neighbors;
    }

    function revealCell(index) {
      if (gameOver || board[index].revealed || board[index].flagged) return;
      board[index].revealed = true;
      revealedCount++;
      if (board[index].mine) {
        gameOver = true;
        revealAllMines();
        alert('Prohrál jste! Klikněte na Restartovat hru pro novou hru.');
        return;
      }
      if (board[index].adjacentMines === 0) {
        const neighbors = getNeighbors(index);
        neighbors.forEach(n => {
          if (!board[n].revealed) revealCell(n);
        });
      }
      updateBoard();
      checkWin();
    }

    function revealAllMines() {
      board.forEach(cell => {
        if (cell.mine) cell.revealed = true;
      });
      updateBoard();
    }

    function toggleFlag(index) {
      if (gameOver || board[index].revealed) return;
      board[index].flagged = !board[index].flagged;
      updateBoard();
    }

    function checkWin() {
      if (revealedCount === board.length - mineCount) {
        alert('Gratulujeme! Vyhráli jste Minesweeper.');
        gameOver = true;
      }
    }

    function updateBoard() {
      gameBoard.innerHTML = '';
      board.forEach((cell, index) => {
        const cellDiv = document.createElement('div');
        cellDiv.classList.add('cell');
        if (cell.revealed) cellDiv.classList.add('revealed');
        if (cell.flagged) cellDiv.classList.add('flagged');
        if (cell.revealed && cell.mine) cellDiv.classList.add('mine');

        if (cell.revealed && !cell.mine && cell.adjacentMines > 0) {
          cellDiv.textContent = cell.adjacentMines;
          cellDiv.style.color = getNumberColor(cell.adjacentMines);
        }

        cellDiv.addEventListener('click', () => revealCell(index));
        cellDiv.addEventListener('contextmenu', e => {
          e.preventDefault();
          toggleFlag(index);
        });

        gameBoard.appendChild(cellDiv);
      });
    }

    function getNumberColor(number) {
      switch(number) {
        case 1: return '#3b82f6'; // blue
        case 2: return '#16a34a'; // green
        case 3: return '#dc2626'; // red
        case 4: return '#2563eb'; // dark blue
        case 5: return '#b91c1c'; // dark red
        case 6: return '#059669'; // teal
        case 7: return '#7c3aed'; // purple
        case 8: return '#f97316'; // orange
        default: return '#000000';
      }
    }

    function initGame() {
      revealedCount = 0;
      gameOver = false;
      createBoard();
      placeMines();
      calculateAdjacentMines();
      updateBoard();
    }

    document.getElementById('btnRestart').addEventListener('click', () => {
      initGame();
    });

    initGame();
  </script>
</body>
</html>
