<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" type="image/x-icon" href="../assets/favicon/favicon.ico" />
  <title>Čtyři v řadě (Connect Four) - Mě to nebaví CZ</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="../assets/theme.css" />
  <script src="../assets/theme.js" defer></script>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet" />
  <style>
    body {
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      padding: clamp(16px, 3vw, 32px);
      gap: 1rem;
    }
    header {
      text-align: center;
    }
    #gameBoard {
      width: min(92vw, 420px);
      aspect-ratio: 7 / 6;
      display: grid;
      grid-template-columns: repeat(7, minmax(0, 1fr));
      gap: clamp(4px, 1vw, 6px);
      padding: clamp(6px, 2vw, 10px);
      background: #0f172a;
      border-radius: 18px;
      border: 1px solid var(--surface-border);
      box-shadow: var(--shadow-soft);
    }
    .cell {
      aspect-ratio: 1 / 1;
      border-radius: 50%;
      background: rgba(148, 163, 184, 0.25);
      box-shadow: inset 0 0 6px rgba(15, 23, 42, 0.45);
      cursor: pointer;
      transition: transform 0.1s ease, background-color 0.2s ease;
    }
    .cell:active {
      transform: scale(0.98);
    }
    .cell.red {
      background-color: #ef4444;
      box-shadow: inset 0 0 8px rgba(127, 29, 29, 0.55);
    }
    .cell.yellow {
      background-color: #fbbf24;
      box-shadow: inset 0 0 8px rgba(161, 98, 7, 0.5);
    }
  </style>
</head>
<body class="game-page">
  <header>
    <h1 class="hero-title">Čtyři v řadě</h1>
    <p class="hero-subtitle">Spojte čtyři kameny v řadě dříve než soupeř.</p>
  </header>

  <div class="panel game-shell" role="main" aria-label="Čtyři v řadě">
    <div class="controls">
      <button id="btnRestart" class="btn btn-secondary">Restart</button>
    </div>
    <div id="gameBoard" role="grid" aria-label="Čtyři v řadě hra"></div>
    <p class="hint">Klikněte na sloupec, kam chcete vložit kámen.</p>
  </div>

  <a href="../games.html" class="link-back">Zpět na výběr her</a>

  <script>
    const rows = 6;
    const cols = 7;
    const gameBoard = document.getElementById('gameBoard');
    let board = [];
    let currentPlayer = 'red';
    let gameActive = true;

    function createBoard() {
      board = Array(rows).fill(null).map(() => Array(cols).fill(null));
      gameBoard.innerHTML = '';
      for (let r = 0; r < rows; r++) {
        for (let c = 0; c < cols; c++) {
          const cell = document.createElement('div');
          cell.classList.add('cell');
          cell.dataset.row = r;
          cell.dataset.col = c;
          cell.setAttribute('role', 'button');
          cell.setAttribute('tabindex', '0');
          cell.addEventListener('click', () => handleClick(c));
          cell.addEventListener('keydown', e => {
            if (e.key === 'Enter' || e.key === ' ') {
              e.preventDefault();
              handleClick(c);
            }
          });
          gameBoard.appendChild(cell);
        }
      }
    }

    function handleClick(col) {
      if (!gameActive) return;
      for (let r = rows - 1; r >= 0; r--) {
        if (!board[r][col]) {
          board[r][col] = currentPlayer;
          updateBoard();
          if (checkWin(r, col)) {
            alert(`Hráč ${currentPlayer === 'red' ? 'červený' : 'žlutý'} vyhrál!`);
            gameActive = false;
          } else if (isDraw()) {
            alert('Remíza!');
            gameActive = false;
          } else {
            currentPlayer = currentPlayer === 'red' ? 'yellow' : 'red';
          }
          break;
        }
      }
    }

    function updateBoard() {
      for (let r = 0; r < rows; r++) {
        for (let c = 0; c < cols; c++) {
          const cell = gameBoard.querySelector(`.cell[data-row="${r}"][data-col="${c}"]`);
          cell.classList.remove('red', 'yellow');
          if (board[r][c]) {
            cell.classList.add(board[r][c]);
          }
        }
      }
    }

    function checkWin(row, col) {
      const directions = [
        {r: 0, c: 1},
        {r: 1, c: 0},
        {r: 1, c: 1},
        {r: 1, c: -1}
      ];
      const player = board[row][col];

      for (const {r: dr, c: dc} of directions) {
        let count = 1;
        count += countDirection(row, col, dr, dc, player);
        count += countDirection(row, col, -dr, -dc, player);
        if (count >= 4) return true;
      }
      return false;
    }

    function countDirection(row, col, dr, dc, player) {
      let r = row + dr;
      let c = col + dc;
      let count = 0;
      while (r >= 0 && r < rows && c >= 0 && c < cols && board[r][c] === player) {
        count++;
        r += dr;
        c += dc;
      }
      return count;
    }

    function isDraw() {
      return board.every(row => row.every(cell => cell !== null));
    }

    document.getElementById('btnRestart').addEventListener('click', () => {
      gameActive = true;
      currentPlayer = 'red';
      createBoard();
    });

    createBoard();
  </script>
</body>
</html>

